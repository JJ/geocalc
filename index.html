<!DOCTYPE html>
<html>
<head>
	<title>Calculator</title>
</head>
<body>
	<div style="width:100%; display: flex; flex-direction: column; align-items: center; font-family: sans-serif; font-size: 32px;">
        <h1>Geocalc</h1>
        <p>Introduce una lista de n√∫meros separados por espacios, comas o punto y coma</p>
      	<input type="text" id="datos" style="width:100%; font-size:24px;" placeholder="Datos" onkeydown="if (event.key === 'Enter') calcular();" oninput="marcarNegativos()">
      	<div id="marcado" style="width:100%; font-size:24px; white-space: pre-wrap; margin-top:4px;"></div>
      	<button onclick="calcular()" style="width:100%;">Calcular</button>
  		<div style="width:100%; display:flex; gap:8px; align-items:center;">
            <h2>La media es:</h2>
			<p id="salida" style="flex:1; margin:0; padding:8px; background:#f5f5f5; border:1px solid #ddd; border-radius:4px;"></p>
			<button id="copy-btn" onclick="copiar()" aria-label="Copiar resultado" title="Copiar resultado" style="padding:8px 12px;">
			&#128203;
			</button>
		</div>
	</div>

	<script>
		function calcular() {
			let datos = document.getElementById("datos").value;
			let numbers = datos.replace(/[\s,;]+/g, " ").trim().split(" ");
			let sum = 0;
			for (let i = 0; i < numbers.length; i++) {
				sum += parseFloat(numbers[i]);
			}
			let average = sum / numbers.length;
			document.getElementById("salida").innerHTML = average;
		}

		function marcarNegativos() {
			const inputEl = document.getElementById('datos');
			const outEl = document.getElementById('marcado');
			const raw = inputEl.value;
			// Split into number tokens and delimiter tokens (spaces, commas, semicolons)
			const tokens = raw.match(/[^\s,;]+|[\s,;]+/g) || [];
			// Find first numeric token
			let firstNum = null;
			for (let i = 0; i < tokens.length; i++) {
				if (/^[\s,;]+$/.test(tokens[i])) continue;
				const n = parseFloat(tokens[i]);
				if (!isNaN(n)) { firstNum = n; break; }
			}
			if (firstNum === null || firstNum >= 0) {
				outEl.innerHTML = '';
				return;
			}
			function esc(s){
				return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
			}
			let html = '';
			for (let i = 0; i < tokens.length; i++) {
				const t = tokens[i];
				if (/^[\s,;]+$/.test(t)) {
					html += t.replace(/ /g,'&nbsp;');
					continue;
				}
				const n = parseFloat(t);
				if (!isNaN(n) && n < 0) {
					html += '<span style="color:red;">' + esc(t) + '</span>';
				} else {
					html += esc(t);
				}
			}
			outEl.innerHTML = html;
		}

		function copiar() {
			const salidaEl = document.getElementById("salida");
			const texto = salidaEl.textContent || salidaEl.innerText || "";
			if (!texto) { return; }
			if (navigator.clipboard && window.isSecureContext) {
				navigator.clipboard.writeText(texto).catch(() => {
					// ignore errors silently
				});
			} else {
				const ta = document.createElement('textarea');
				ta.value = texto;
				ta.style.position = 'fixed';
				ta.style.opacity = '0';
				document.body.appendChild(ta);
				ta.focus();
				ta.select();
				try { document.execCommand('copy'); } finally { document.body.removeChild(ta); }
			}
		}
	</script>
</body>
</html>
